\documentclass[t, 10pt, aspectratio=169, table, x11names]{beamer}
\usetheme{metropolis}

\input{/common/template}

\begin{document}

	%Author, Title and subtitle
	\author{Victor Mayrink}
	\title{Curso de SQL}
	\subtitle{Aula 0: Introdução e motivação}

	%Fame: title
	\begin{frame}[plain]
		\maketitle
	\end{frame}
	
	%Frame: agenda
	\begin{frame}
		\frametitle{Agenda}
		\vspace{1cm}
		\begin{enumerate}
			\large
			\item O que é SQL
			\item Por quê aprender SQL?
			\item Instalação e configuração das ferramentas
		\end{enumerate}
	\end{frame}
	
	%Frame: sql meaning
	\begin{frame}
		\frametitle{O que é SQL?}
		\vspace{0.3cm}
		\begin{itemize}
			\setlength{\itemsep}{8pt}
			\item A sigla SQL significa \textbf{\textit{Structured Query Language}}
			\item Beleza, mas que \textit{diabos} é isso?
			\vspace{5mm}
			\begin{figure}[h]
				\fbox{\includegraphics[width=0.55\textwidth]{query-meaning.png}}
			\end{figure}
		\end{itemize}
	\end{frame}

	%Frame: questions are more important than answers
	\begin{frame}
		\frametitle{O que é SQL?}
		\vspace{2mm}
		\begin{itemize}
			\setlength{\itemsep}{8pt}
			\item SQL é uma linguagem para \textit{fazer \textbf{perguntas} à um banco de dados}
		\end{itemize}
		\vspace{2mm}
		\begin{figure}[h]
			\includegraphics[height=40mm]{voltaire.jpg}
			\hspace{5mm}
			\includegraphics[height=40mm]{peter-drucker.jpg}
		\end{figure}
	\end{frame}

	%Frame: sql usage
	\begin{frame}
		\frametitle{O que é SQL?}
		\vspace{0.3cm}
		\begin{itemize}
			\setlength{\itemsep}{8pt}
			\item Estritamente falando, o SQL não serve \textit{\textbf{somente}} para fazer perguntas. 
			\item O SQL é a linguagem mais utilizada para executar comandos em um banco de dados
			\vspace{0.11cm}
			\begin{itemize}
				\item criar tabelas,
				\item inserir novos registros,
				\item atualizar registros existentes,
				\item excluir registros,
				\item etc... (veremos mais adiante)
			\end{itemize}
			\vspace{0.5cm}
			\begin{center}
				No entanto, o SQL é utilizado principalmente para realizar \textit{consultas} no banco.\\
				Ou seja, \textbf{fazer perguntas}.
			\end{center}
		\end{itemize}
	\end{frame}

	%Frame: why you should learn SQL
	\begin{frame}
		\frametitle{Por quê aprender SQL?}
		\reasonboxbegin{Motivo 1}{MaterialPink900}
			SQL é uma habilidade muito útil no dia a dia e, portanto, muito procurada pelo mercado. Quando não é uma exigência, certamente torna-se um diferencial.
		\reasonboxend
		\reasonboxbegin{Motivo 2}{MaterialPink900}
			Conhecer SQL \textbf{não} é coisa dos \textit{caras da TI}. 
		\reasonboxend
		\reasonboxbegin{Motivo 3}{MaterialPink900}
			SQL é uma \textit{linguagem universal}. Adotada nos principais bancos de dados existentes.
		\reasonboxend
	\end{frame}

	%Frame: why you should learn SQL
	\begin{frame}
		\frametitle{Por quê aprender SQL?}
		\reasonboxbegin{Motivo 4}{MaterialPink900}
			O entendimento de como os dados da empresa estão organizados contribui para o profissional tenha uma \textit{visão mais sistêmica do negócio} e dos processos operacionais.
		\reasonboxend
		\reasonboxbegin{Motivo 5}{MaterialPink900}
			\textit{Individualmente}, o SQL contribuí para a capacidade analítica do profissional
		\reasonboxend
		\reasonboxbegin{Motivo 6}{MaterialPink900}
			\textit{Coletivamente}, o uso extensivo de SQL entre os profissionais de uma empresa contribui para a criação de uma cultura orientada a dados e resultados
		\reasonboxend
	\end{frame}

	%Frame: why you should learn SQL
	\begin{frame}
		\frametitle{Por quê aprender SQL?}
		\reasonboxbegin{Motivo 7}{MaterialBlue600}
			Você vai passar a entender os memes e piadas de programadores\footnote{Pelo menos as que forem relacionadas a bancos de dados}
		\reasonboxend
	\end{frame}
	
	\section{Bora começar!}
	
	%Frame: doctor scheduling example
	\begin{frame}
		\frametitle{Registro de dados}
		\vspace{3mm}
		Imagine um formulário para fazer o agendamento de uma consulta médica...
		\begin{columns}[t]
			\begin{column}{0.50\textwidth}
				\vspace{0.3cm}
				\begin{figure}[h]
					\includegraphics[width=63mm, right]{sample-form.png}
				\end{figure}
			\end{column}
			\begin{column}{0.53\textwidth}
				\begin{itemize}					
					\item O formulário possui diversos \textit{\textbf{campos}} que devem ser preenchidos
					\vspace{2mm}
					\item Cada campo do formulário armazena um determinado \textit{\textbf{tipo de dado}}
					\vspace{2mm}
					\begin{itemize}
						\ttfamily\small
						\item Nome: texto
						\item Data de nascimento: data
						\item Peso e altura: numérico
						\item Possui comorbidades: sim/não
						\item Agendamento: data e horário
					\end{itemize}
				\end{itemize}
			\end{column}
			\begin{column}{0.05\textwidth}
			\end{column}
		\end{columns}
	\end{frame}
	
	%Frame: doctor scheduling example
	\begin{frame}
		\frametitle{Registro de dados}
		\begin{columns}[t]
			\begin{column}{0.40\textwidth}
				\begin{figure}[h]
					\includegraphics[width=50mm, right]{paper-stack}
				\end{figure}
			\end{column}
			\begin{column}{0.55\textwidth}
				\vspace{2mm}
				
				As fichas do formulário podem ser armazenadas em uma tabela 
				\begin{itemize}
					\bigskip\bigskip
					\item Cada ficha preenchida torna-se uma \textbf\textit{linha} ou \textbf{\textit{registro}} na tabela
					\bigskip
					\item Os campos do formulário tornam-se \textbf{\textit{colunas}} na tabela
				\end{itemize}
			\end{column}
			\begin{column}{0.05\textwidth}
			\end{column}
		\end{columns}
	\end{frame}

	%Frame: insert
	\begin{frame}
		\frametitle{Registro de dados}
		Alguns dados fictícios (gerados pelo ChatGPT)
		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{nome\_paciente} & \textbf{data\_nasc\_paciente} & \textbf{nome\_medico} & \textbf{especialidade\_medico} & \textbf{data\_hora\_consulta} \\
				\hline
				Alice Oliveira & 12/03/1979 & Dr. Martins & Cardiologia & 18/07/2024 10:00 \\
				\hline
				Alice Oliveira & 12/03/1979 & Dra. Santos & Dermatologia & 22/07/2024 15:30 \\
				\hline
				Carlos Souza & 05/08/1985 & Dr. Almeida & Ortopedia & 05/06/2024 08:45 \\
				\hline
				Carlos Souza & 05/08/1985 & Dra. Lima & Pediatria & 12/06/2024 14:00 \\
				\hline
				Maria Silva & 30/11/1967 & Dr. Pereira & Oftalmologia & 10/07/2024 09:15 \\
				\hline
				Maria Silva & 30/11/1967 & Dra. Costa & Ginecologia & 18/07/2024 11:00 \\
				\hline
				João Santos & 20/04/1992 & Dr. Almeida & Neurologia & 02/08/2024 16:30 \\
				\hline
				João Santos & 20/04/1992 & Dra. Lima & Endocrinologia & 09/08/2024 08:00 \\
				\hline
				Luana Oliveira & 15/09/1988 & Dr. Costa & Urologia & 15/06/2024 13:45 \\
				\hline
				Luana Oliveira & 15/09/1988 & Dra. Santos & Psiquiatria & 25/06/2024 10:30 \\
				\hline
				Rafaela Lima & 03/07/1983 & Dr. Martins & Oftalmologia & 20/07/2024 14:15 \\
				\hline
				Rafaela Lima & 03/07/1983 & Dra. Costa & Dermatologia & 28/07/2024 09:45 \\
				\hline
				Pedro Almeida & 10/10/1975 & Dr. Pereira & Cardiologia & 05/08/2024 11:30 \\
				\hline
				Pedro Almeida & 10/10/1975 & Dra. Santos & Pediatria & 12/08/2024 15:00 \\
				\hline
			\end{tabular}
		\end{table}
	\end{frame}
	
	%Frame: create table
	\begin{frame}
		\frametitle{Criação da tabela no SQL}
		Para criar uma tabela como essa, utilizamos o comando \bluehighlight{CREATE TABLE}:
		\lstinputlisting[language=Sql]{table-consultas-create-1.sql}
		Vamos analisar a estrutura desse comando:
		\lstinputlisting[language=Sql]{table-consultas-create-2.sql}
	\end{frame}	
	
	%Frame: insert records
	\begin{frame}
		\frametitle{Inserir registros na tabela}
		Para inserir registros, utilizamos o comando \bluehighlight{INSERT INTO ... VALUES}:
		\lstinputlisting[language=Sql, xleftmargin=0mm, xrightmargin=0mm]{table-consultas-ingest-1.sql}
	\end{frame}

	%Frame: select
	\begin{frame}
		\frametitle{Consultar registros}
		Para consultar os registros de uma tabela, usamos o comando \bluehighlight{SELECT}.
		\lstinputlisting[language=Sql]{table-consultas-select-1.sql}
		Resposta do servidor:
		\lstinputlisting[language=Sql]{table-consultas-select-1-result.sql}
	\end{frame}

	%Frame: practical case
	\begin{frame}
		\frametitle{Exemplo prático com o Dbeaver}
		Para consultar os registros de uma tabela, usamos o comando \bluehighlight{SELECT}.
		\lstinputlisting[language=Sql]{table-consultas-select-1.sql}
		Resposta do servidor:
		\lstinputlisting[language=Sql]{table-consultas-select-1-result.sql}
	\end{frame}
	
	%Frame: update
	\begin{frame}
		\frametitle{Atualizar registros}
		Para atualizar os registros de uma tabela, usamos o comando \bluehighlight{UPDATE...SET} 
		\lstinputlisting[language=Sql]{table-consultas-update-1.sql}
		Se fizermos a consulta novamente
		\lstinputlisting[language=Sql]{table-consultas-select-1.sql}
		\lstinputlisting[language=Sql]{table-consultas-select-1-result-2.sql}
	\end{frame}

	\begin{frame}
		\frametitle{Atualizar registros}
		\vspace{-3mm}
		\reasonboxbegin{Importante}{MaterialTeal800}
			\small
			Observe que o comando \bluehighlight{UPDATE...SET} vai atualizar \textbf{todos} os registros que satisfazem as condições impostas na cláusula \bluehighlight{WHERE}.
		\reasonboxend

		\bigskip
		\lstinputlisting[language=Sql]{table-consultas-update-1.sql}

		\footnotesize{Vai atualizar o valor da coluna \code{data\_hora\_consulta} para \code{2024-07-31 15:00} de \textbf{todos} os registros que satifazem as condições:
		\begin{enumerate}
			\scriptsize
			\item \code{nome\_paciente = `Maria Silva'}
			\item \code{nome\_medico = `Dra. Costa'}
			\item \code{data\_hora\_consulta = `2024-07-18 11:00:00'}.
		\end{enumerate}
		}

	\end{frame}

	\begin{frame}
		\frametitle{Atualizar registros}
		\vspace{-3mm}
		\reasonboxbegin{Pergunta}{MaterialTeal800}
			\small
			E se eu executar o comando \bluehighlight{UPDATE...SET} sem a cláusula \bluehighlight{WHERE}?
		\reasonboxend
		\begin{figure}
			\centering
			\includegraphics[height=37mm]{update-no-where-01}
			\hspace{5mm}
			\includegraphics[height=37mm]{update-no-where-02}
			\hspace{5mm}
			\includegraphics[height=37mm]{update-no-where-04}
		\end{figure}
		\blfootnote{\hrefself{https://www.reddit.com/r/programacao/comments/186omuj/}}
		\blfootnote{\hrefself{https://www.reddit.com/r/memes\_pt/comments/a5txqt/}}
		\blfootnote{\hrefself{https://www.canecadodev.com/quadro-em-caso-de-update-sem-where-compareca-ao-rh}}
	\end{frame}
	
	%Frame: delete
	\begin{frame}
		\frametitle{Deletar registros}
		Para apagar um registro utilizamos o comando \bluehighlight{DELETE}
		\lstinputlisting[language=Sql]{table-consultas-delete-1.sql}
	\end{frame}
	
	%Section: Primary keys
	\section{Chaves primárias}

	\begin{frame}[t]
		\frametitle{Problema}
		Suponha que um analista inseriu, acidentalmente, dois registros iguais na tabela de consultas. Para eliminar a duplicidade, o analista precisa excluir um dos registros.
		
		Exemplo:
		\bigskip
		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{nome\_paciente} & \textbf{data\_nasc\_paciente} & \textbf{nome\_medico} & \textbf{especialidade\_medico} & \textbf{data\_hora\_consulta} \\
				\hline
				Alice Oliveira & 12/03/1979 & Dr. Martins & Cardiologia & 18/07/2024 10:00 \\
				\hline
				Alice Oliveira & 12/03/1979 & Dra. Santos & Dermatologia & 22/07/2024 15:30 \\
				\hline
				Carlos Souza & 05/08/1985 & Dr. Almeida & Ortopedia & 05/06/2024 08:45 \\
				\hline
				Carlos Souza & 05/08/1985 & Dra. Lima & Pediatria & 12/06/2024 14:00 \\
				\hline
				Carlos Souza & 05/08/1985 & Dra. Lima & Pediatria & 12/06/2024 14:00 \\
				\hline
			\end{tabular}
		\end{table}
	\end{frame}

	\begin{frame}[t]
		\frametitle{Chaves primárias}
		Vamos tentar o seguinte:
		\bigskip
		\lstinputlisting[language=Sql]{delete-duplicate-attempt.sql}
		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{nome\_paciente} & \textbf{data\_nasc\_paciente} & \textbf{nome\_medico} & \textbf{especialidade\_medico} & \textbf{data\_hora\_consulta} \\
				\hline
				Alice Oliveira & 12/03/1979 & Dr. Martins & Cardiologia & 18/07/2024 10:00 \\
				\hline
				Alice Oliveira & 12/03/1979 & Dra. Santos & Dermatologia & 22/07/2024 15:30 \\
				\hline
				Carlos Souza & 05/08/1985 & Dr. Almeida & Ortopedia & 05/06/2024 08:45 \\
				\hline
			\end{tabular}
		\end{table}
	\end{frame}

	\begin{frame}[t]
		\frametitle{Chaves primárias}
		\textbf{Conclusão:} Como os registros estão duplicados fica difícil \textit{especificar} para o banco de dados qual deles, gostaríamos de deletar.
		\reasonboxbegin{Chaves primárias}{MaterialTeal800}
			Uma chave primária é uma coluna (ou colunas), cujos valores identificam \textbf{unicamente} um registro da tabela.
		\reasonboxend
		\bigskip
		Ou seja...

		A chave primária é como um "CPF" da linha. Não pode haver duas (ou mais) linhas com um mesmo valor para a chave primária. 
	\end{frame}

	\begin{frame}[t]
		\frametitle{Chaves primárias}
		Vamos recriar a tabela de consultas com uma chave primária:
		\bigskip
		\lstinputlisting[language=Sql]{table-consultas-pk.sql}
		\bigskip
		Utilizando o comando \bluehighlight{AUTO\_INCREMENT} nós não precisamos nos preocupar em atribuir um id para cada registro. O próprio banco se encarrega de gerar um registro único.
	\end{frame}

	\begin{frame}
		\frametitle{Chaves primárias}
		Podemos utilizar exatamente a mesma query para fazer a ingestão de dados.

		Não é necessário especificar um valor para a coluna \texttt{id}.
		\bigskip
		\lstinputlisting[language=Sql, xleftmargin=0mm, xrightmargin=0mm]{table-consultas-ingest-1.sql}
	\end{frame}

	\begin{frame}[t]
		\frametitle{Problema}
		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{id} & \textbf{nome\_paciente} & \textbf{data\_nasc\_paciente} & \textbf{nome\_medico} & \textbf{especialidade\_medico} & \textbf{data\_hora\_consulta} \\
				\hline
				1 & Alice Oliveira & 12/03/1979 & Dr. Martins & Cardiologia & 18/07/2024 10:00 \\
				\hline
				2 & Alice Oliveira & 12/03/1979 & Dra. Santos & Dermatologia & 22/07/2024 15:30 \\
				\hline
				3 & Carlos Souza & 05/08/1985 & Dr. Almeida & Ortopedia & 05/06/2024 08:45 \\
				\hline
				4 & Carlos Souza & 05/08/1985 & Dra. Lima & Pediatria & 12/06/2024 14:00 \\
				\hline
				5 & Maria Silva & 30/11/1967 & Dr. Pereira & Oftalmologia & 10/07/2024 09:15 \\
				\hline
				6 & Maria Silva & 30/11/1967 & Dra. Costa & Ginecologia & 18/07/2024 11:00 \\
				\hline
				7 & João Santos & 20/04/1992 & Dr. Almeida & Neurologia & 02/08/2024 16:30 \\
				\hline
				8 & João Santos & 20/04/1992 & Dra. Lima & Endocrinologia & 09/08/2024 08:00 \\
				\hline
				9 & Luana Oliveira & 15/09/1988 & Dr. Costa & Urologia & 15/06/2024 13:45 \\
				\hline
				10 & Luana Oliveira & 15/09/1988 & Dra. Santos & Psiquiatria & 25/06/2024 10:30 \\
				\hline
				11 & Rafaela Lima & 03/07/1983 & Dr. Martins & Oftalmologia & 20/07/2024 14:15 \\
				\hline
				12 & Rafaela Lima & 03/07/1983 & Dra. Costa & Dermatologia & 28/07/2024 09:45 \\
				\hline
				13 & Pedro Almeida & 10/10/1975 & Dr. Pereira & Cardiologia & 05/08/2024 11:30 \\
				\hline
				14 & Pedro Almeida & 10/10/1975 & Dra. Santos & Pediatria & 12/08/2024 15:00 \\
				\hline
			\end{tabular}
		\end{table}
	\end{frame}

	\begin{frame}[t]
		\frametitle{Chaves primárias composta}
		Algumas vezes, o valor de uma determinada coluna, não é necessariamente único, mas quando combinado com outra coluna produz uma chave única.
		
		Exemplo: DDD + número de telefone

		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{ddd} & \textbf{telefone} & \textbf{operadora} & \textbf{titular} \\
				\hline
				21 & 99456-7890 & Telekoko & 123.456.789-00 \\
				\hline
				11 & 99456-7890 & Telekoko & 526.881.987-01 \\
				\hline
				11 & 99123-4045 & Telekaka & 526.881.987-01 \\
				\hline
			\end{tabular}
		\end{table}

	\end{frame}

	%Section: Lesson's final questions
	\section{Perguntas sobre esta aula}

	\begin{frame}[t]
		\frametitle{Problema}
		Suponha que um analista inseriu, acidentalmente, dois registros iguais em na tabela de consultas. Para eliminar a duplicidade, o analista precisa excluir um dos registros.

		Exemplo:

		\begin{table}[ht]
			\centering
			\footnotesize
			\begin{tabular}{|l|l|l|l|l|}
				\hline
				\rowcolor{SeaGreen3!30!}
				\textbf{nome\_paciente} & \textbf{data\_nasc\_paciente} & \textbf{nome\_medico} & \textbf{especialidade\_medico} & \textbf{data\_hora\_consulta} \\
				\hline
				Alice Oliveira & 12/03/1979 & Dr. Martins & Cardiologia & 18/07/2024 10:00 \\
				\hline
				Alice Oliveira & 12/03/1979 & Dra. Santos & Dermatologia & 22/07/2024 15:30 \\
				\hline
				Carlos Souza & 05/08/1985 & Dr. Almeida & Ortopedia & 05/06/2024 08:45 \\
				\hline
				Carlos Souza & 05/08/1985 & Dra. Lima & Pediatria & 12/06/2024 14:00 \\
				\hline
				Maria Silva & 30/11/1967 & Dr. Pereira & Oftalmologia & 10/07/2024 09:15 \\
				\hline
				Maria Silva & 30/11/1967 & Dra. Costa & Ginecologia & 18/07/2024 11:00 \\
				\hline
				João Santos & 20/04/1992 & Dr. Almeida & Neurologia & 02/08/2024 16:30 \\
				\hline
				João Santos & 20/04/1992 & Dra. Lima & Endocrinologia & 09/08/2024 08:00 \\
				\hline
				Luana Oliveira & 15/09/1988 & Dr. Costa & Urologia & 15/06/2024 13:45 \\
				\hline
				Luana Oliveira & 15/09/1988 & Dra. Santos & Psiquiatria & 25/06/2024 10:30 \\
				\hline
				Rafaela Lima & 03/07/1983 & Dr. Martins & Oftalmologia & 20/07/2024 14:15 \\
				\hline
				Rafaela Lima & 03/07/1983 & Dra. Costa & Dermatologia & 28/07/2024 09:45 \\
				\hline
				Pedro Almeida & 10/10/1975 & Dr. Pereira & Cardiologia & 05/08/2024 11:30 \\
				\hline
				Pedro Almeida & 10/10/1975 & Dra. Santos & Pediatria & 12/08/2024 15:00 \\
				\hline
			\end{tabular}
		\end{table}

	\end{frame}

\end{document}